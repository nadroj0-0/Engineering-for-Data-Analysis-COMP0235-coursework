global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "/etc/prometheus/rules/*.yml"

scrape_configs:

  # Prometheus monitoring itself
  - job_name: "prometheus"
    scrape_interval: 5s
    static_configs:
      - targets:
          - "localhost:9090"

  # Node exporter on all machines
  - job_name: "node_exporter"
    scrape_interval: 15s
    static_configs:
      - targets:
{% for host in groups['all'] %}
          - "{{ hostvars[host].ansible_host }}:9100"
{% endfor %}
