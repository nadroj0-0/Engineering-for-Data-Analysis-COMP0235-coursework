---
#Clone all the necessary folders and files from the git repo and put inside host
- name: Create temporary git directory
  ansible.builtin.file:
    path: /tmp/V2coursework
    state: directory
    mode: "0755"

- name: Temporary clone entire V2coursework git repository
  ansible.builtin.git:
    repo: "{{gitrepourl}}"
    dest: /tmp/V2coursework
    version: main
    force: yes
    update: yes
    accept_hostkey: yes

- name: Remove old data directory
  ansible.builtin.file:
    path: /home/almalinux/data/
    state: absent

- name: Create data directory
  ansible.builtin.file:
    path: /home/almalinux/data
    state: directory
    owner: almalinux
    group: almalinux
    mode: "0755"

- name: Copy data folder
  ansible.builtin.copy:
    src: /tmp/V2coursework/data/
    dest: /home/almalinux/data/
    owner: almalinux
    group: almalinux
    mode: "0755"          #6-owner:rw, 4-group:r, 4-others:r
    remote_src: yes


- name: Remove old pipeline_example directory
  ansible.builtin.file:
    path: /home/almalinux/pipeline_example/
    state: absent

- name: Create pipeline_example directory
  ansible.builtin.file:
    path: /home/almalinux/pipeline_example
    state: directory
    owner: almalinux
    group: almalinux
    mode: "0755"          #7-owner:rwe, 5-group:re, 5-others:re

- name: Copy pipeline_example folder
  ansible.builtin.copy:
    src: /tmp/V2coursework/pipeline_example/
    dest: /home/almalinux/pipeline_example/
    owner: almalinux
    group: almalinux
    mode: "0755"          #7-owner:rwe, 5-group:re, 5-others:re
    remote_src: yes

- name: Remove old control directory
  ansible.builtin.file:
    path: /home/almalinux/control/
    state: absent

- name: Create control directory
  ansible.builtin.file:
    path: /home/almalinux/control
    state: directory
    owner: almalinux
    group: almalinux
    mode: "0755"          #7-owner:rwe, 5-group:re, 5-others:re

- name: Copy control folder
  ansible.builtin.copy:
    src: /tmp/V2coursework/control/
    dest: /home/almalinux/control/
    owner: almalinux
    group: almalinux
    mode: "0755"          #7-owner:rwe, 5-group:re, 5-others:re
    remote_src: yes

- name: Copy inventory.ini file to control folder
  ansible.builtin.copy:
    src: /home/almalinux/provision/inventory.ini
    dest: /home/almalinux/control/inventory.ini
    owner: almalinux
    group: almalinux
    mode: "0755"          #7-owner:rwe, 5-group:re, 5-others:re

- name: Delete git repoistory download fdoler
  ansible.builtin.file:
    path: /tmp/V2coursework
    state: absent
